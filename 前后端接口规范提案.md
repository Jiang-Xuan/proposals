# 前后端接口规范提案



- [x] 提案文件

- [ ] 征求初始意见

- [ ] 0.1.0 文档

- [ ] 文档征求意见

- [ ] 0.2.0 文档

- [ ] 1.0.0 版本之前的最后的意见征集

- [ ] 1.0.0-beta 规范发布, 开始实施

  

## 动机和痛点



目前 insight 的前后端通过接口进行数据通讯, 接口没有一个明确的规范来约定接口格式, 导致有时候不同的开发者无法统一接口格式, 进而无法抽出一些关于接口的一些逻辑. 该提案目的在于统一接口的格式, 能够更清晰的帮助开发者在定义 mock 接口, 接口联调的时候避免在格式上消耗精力.



## 痛点 Examples

目前 insight 已经存在的接口存在的问题:



### 接口的根字段不统一



* 登录的时候获取验证码接口 https://db.dxy.net/dev/user/token/desk/1?email=jiangxuan3@dxy.cn 的响应 json 

  ```json
  {
    code: 100
    key: "5d0b5f357c7b2iau0zhcn67m00k2gwmfi"
    phead: "152"
    phone: "3459"
    userid: "73105"
  }
  ```

* 数据库首页获取药圈一周大事件的接口 https://db.dxy.net/dev/api/news?topic=0&p=1&plimit=10

  ```json
  {
    "msgCode": 507,
    "success": true,
    "info": "获取成功",
    "data": {
      "topic": [
        {
          "key": 0,
          "name": "综合"
        }
      ],
      "pages": {
        "p-total": 12,
        "p-limit": 10,
        "p-cur": 1
      },
      "list": [
        {
          "label": {
            "text": "HOT",
            "type": "1"
          },
          "desc": "首个国产雌二醇上市！浙江亚太药业股份有限公司将面临仿制药冲击",
          "descEn": "",
          "topic": {
            "key": 3,
            "name": "首仿"
          },
          "time": 1556423727,
          "readed": false,
          "href": "https://db.dxy.net/dev/drugnews/detail/aid/719930?isDynamics=1"
        }
      ]
    }
  }
  ```

* 获取用户搜索历史的接口 https://db.dxy.net/dev/index/history

  ```json
  {
    "msgCode": 507,
    "success": true,
    "results": {
      "items": []
    }
  }
  ```

  

* cde 列表搜索接口 https://db.dxy.net/dev/cde/search

  ```json
  {
    exports: {
      name: "导出表格",
      showProgress: true,
      canExport: true,
      // ...
    },
    group: [],
    msgCode: 507,
    pages: {
      "p-cur": 1,
      "p-limit": 10,
      "p-total": 196293
    },
    success: true,
    tab: [],
    table: {
      defaultHead: [/*...*/],
      "t-head": [/*...*/],
      "t-rows": [/*...*/]
    }
    _processtime: {}
  }
  ```

  

* 添加用户的标新数据 https://db.dxy.net/dev/fav/add?name=1090&type=48

  ```json
  {
    data: []
    msg: "修改成功！"
    success: true
  }
  ```

  

从上述接口可以看到



* 接口的响应信息字段命名不同, 有的接口命名为 `msg`, 有的命名为 `info`.
* 接口的响应码字段命名不同, 有的接口命名为 `code`, 有的命名为 `msgCode`, 有的接口没有响应码字段
* 接口的响应码含义混乱, 不知道 `100` 代表什么, `507` 又代表着什么
* 数据的存放位置不确定, 有的数据放置在了根下, 有的数据放置在了 `data` 字段下, 有的数据放置在了 `results` 下
* 验证码的接口响应没有 `success` 字段



### 接口的字段名命名格式不统一



* cde 列表搜索接口 https://db.dxy.net/dev/cde/search

  ```json
  table: {
    defaultHead: [/*...*/],
    "t-head": [/*...*/],
    "t-rows": [/*...*/]
  }
  ```



从上述接口可以看到, `defaultHead` 采用了 camelCase 格式, `t-head` 采用了连字符格式



## 解决方案



### 接口的 root 根字段



